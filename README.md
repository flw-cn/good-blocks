# good-blocks

> **「good blocks 总比 bad blocks 要好」** 😉  
> *致敬经典的 badblocks，但我们相信硬盘健康不只是好坏二分*

一个安全、直观的硬盘健康检测工具，专为普通用户设计。

## 概述

`good-blocks` 是一个硬盘读取性能测试工具，它通过测量硬盘块的读取响应时间来评估硬盘健康状况。与传统的 `badblocks` 工具不同，`good-blocks` 提供了更丰富的性能分级和更直观的用户体验。

### 为什么选择 good-blocks？

> **"不是好/坏，而是好/更好/最好"** ⭐

- **绝对安全** 🛡️ - 只进行读取测试，永不写入，对您的数据零风险
- **智能分级** 📊 - 将读取性能分为多个等级，而非简单的好坏二分
- **用户友好** 🎯 - 百分比输入，实时进度显示，彩色输出，易于理解的结果报告
- **智能适配** 🔧 - 自动检测设备类型（SSD/HDD），智能调整测试参数
- **详细日志** 📝 - 可选的详细日志记录，便于后续分析

## 主要特性

### 🔍 多级性能分类

根据设备类型自动生成适合的性能分类：

**SSD/NVMe 设备**：
- 极佳 (≤1ms) 
- 优秀 (≤3ms)
- 良好 (≤5ms)
- 正常 (≤10ms)
- 偏慢 (≤20ms)
- 异常 (≤50ms)
- 严重 (≤100ms)

**机械硬盘**：
- 优秀 (≤8ms)
- 良好 (≤15ms) 
- 正常 (≤25ms)
- 偏慢 (≤50ms)
- 较慢 (≤100ms)
- 很慢 (≤200ms)
- 极慢 (≤500ms)

### 🎯 可疑块重测机制

对响应时间异常的块进行多次重测，去除极值后取平均值，确保结果准确性。

### 📈 实时进度显示

```
进度: 45.2% | 速度: 1250 块/秒 | 剩余: 0h15m32s | 极佳: 45120 优秀: 12350 良好: 2180 ...
```

### 🔧 灵活的扫描选项

- **抽样扫描**：支持按百分比进行抽样检测，硬盘再大也不怕！
- **随机采样**：花样走位骚操作，不怕坏道躲起来！
- **范围指定**：支持按扇区号或百分比指定检测范围，重点关注关键区域！

## 安装

### 编译要求

- GCC 编译器
- Linux 系统（需要 `/sys/block` 文件系统支持）

### 编译方法

```bash
gcc -o good-blocks main.c -lm
```

## 使用方法

### 基本语法

```bash
./good-blocks <设备> <起始扇区> <结束扇区> [选项]
```

### 常用示例

#### 1. 全盘检测
```bash
./good-blocks /dev/sda 0 100%
```

#### 2. 检测指定范围（末尾10%区域）
```bash
./good-blocks /dev/sda 90% 100%
```

#### 3. 抽样检测（10%采样）
```bash
./good-blocks /dev/sda 0 100% -s 10
```

#### 4. 详细日志记录
```bash
./good-blocks /dev/sda 0 100% -l scan.log -L 50
```

#### 5. 自定义块大小和可疑块参数
```bash
./good-blocks /dev/sda 0 100% -b 4096 -S 200 -R 5
```

### 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `-b <块大小>` | 读取块大小（字节） | 512 |
| `-l <日志文件>` | 日志文件路径 | 无 |
| `-L <阈值>` | 记录到日志的时间阈值（ms） | 100 |
| `-c <配置文件>` | 自定义时间分类配置 | 自动生成 |
| `-s <百分比>` | 抽样检测百分比 | 100 |
| `-r` | 启用随机采样 | 均匀采样 |
| `-w <因子>` | 等待时间因子（%） | 0 |
| `-S <阈值>` | 可疑块判定阈值（ms） | 自动 |
| `-R <次数>` | 可疑块重测次数 | 10 |
| `-I <间隔>` | 可疑块重测间隔（ms） | 100 |

## 输出示例

```
【参数信息】设备: /dev/sda
【参数信息】测试范围: 0 - 100%
【设备类型】类型: SSD
【设备类型】厂商: Samsung
【设备类型】型号: SSD 980 PRO 1TB
【准备扫描】时间分类定义:
【准备扫描】  极佳: ≤   1 ms
【准备扫描】  优秀: ≤   3 ms
【准备扫描】  良好: ≤   5 ms
...

进度: 100.0% | 速度: 1856 块/秒 | 剩余: 0h00m00s | 极佳: 1950234 优秀: 15678 良好: 2341 ...

===== 坏道检测报告 =====
总扇区数: 1953525168 (931.51 GB)
总块数: 1953525168
抽样扫描块数: 1953525168 (100.00%)
实际测试块数: 1968253
总扫描时间: 1052.3 秒
平均速度: 895.2 MB/s
------------------------
极佳   (≤   1 ms): 1950234 块 (99.08%)
优秀   (≤   3 ms):   15678 块 ( 0.80%)
良好   (≤   5 ms):    2341 块 ( 0.12%)
正常   (≤  10 ms):       0 块 ( 0.00%)
...
坏道   (> 500 ms):       0 块 ( 0.00%)
```

## 注意事项

1. **权限要求**：需要 root 权限或对设备文件的读取权限
2. **设备安全**：请确保指定正确的设备路径，避免误操作
3. **运行时间**：全盘检测可能需要较长时间，建议先用抽样模式测试
4. **系统负载**：检测过程会产生持续的磁盘 I/O，可能影响系统性能

## 高级功能

### 自定义时间分类配置

创建配置文件 `categories.conf`：

```
极佳,1,\033[1;32m
优秀,3,\033[32m
良好,5,\033[36m
正常,10,\033[33m
偏慢,20,\033[35m
异常,50,\033[31m
严重,100,\033[1;31m
坏道,0,\033[1;31m
```

格式：`名称,时间上限(ms),颜色代码`

### 日志文件格式

日志文件记录超过阈值的扇区信息：

```
# Disk Health Scan Report
# Device: /dev/sda
1245760 # 2024-01-15 14:30:25 # 156 ms # 较慢 # 1 sectors
1245761 # 2024-01-15 14:30:25 # 203 ms # 很慢 # 1 sectors
```

## 致谢

**Goodblocks: made with AI & ♥️**

本程序 99% 由 AI 生成，感谢 Gemini、DeepSeek、Claude Sonnet 4、GitHub Copilot。

当然，最后那 1% 才是最关键的。

## 许可证

本项目采用 GPLv3 许可证 - 详见 [LICENSE](LICENSE) 文件。

这意味着您可以自由地使用、修改和分发本软件，但任何衍生作品也必须在相同的许可证下发布。

## 贡献

欢迎提交 Issue 和 Pull Request！让我们一起让 `good-blocks` 变得更好。

## 免责声明

虽然本工具设计为只读操作，但任何硬盘操作都存在潜在风险。使用前请备份重要数据，作者不承担任何数据丢失责任。
